function LoadEmailLists(){$.ajax({url:"../Cloud/GetEmailLists",type:"post",data:JSON.stringify({cid:CurrentCompany}),contentType:"application/json",dataType:"json",traditional:"true",success:function(n){if(n.Success){$("#activeEmailList").html("");for(var t=0;t<n.Data.length;t++)$("#activeEmailList").append('<option value="'+n.Data[t].UId+'">'+n.Data[t].Name+"<\/option>")}}})}function ClearEmailListError(){$("#emailListError").html("");$("#emailListModal").modal("hide")}function LoadCustomers(){$("#mainHolder > section").html('<div class="row"><div class="col-md-12"><h3 class="text-center">Loading Data...<\/h3><\/div><\/div>');var n="",t=searchInformation;$.ajax({url:"../Cloud/Contacts",type:"get",data:t,contentType:"application/json",dataType:"json",traditional:"true",success:function(t){var r,f,e,i,u;if(t.Success){for(customers=t.Data,searchInformation=t.Information,filters=[];currentFilters.length>0;)currentFilters.pop();for(i=0;i<searchInformation.Filters.length;i++)currentFilters.push(searchInformation.Filters[i]);if(t.Data.length<0)return;for($("#page").html(""),r=1;r<=searchInformation.TotalPages;r++)$("#page").append('<option value="'+r+'">'+r+"<\/option>");if($("#page").val(""+searchInformation.Page),t.Data.length==0){$("#mainHolder > section").html('<div class="row"><div class="col-md-12"><h3 class="text-center">No Customers Matches Criteria<\/h3><\/div><\/div>');return}for(n+='<table class="table table-striped table-registration-data"><thead class="dataHeader"><tr>',n+='<th class="no-wrap el-action-td ela-header">ELA<\/th>',i=0;i<t.Data[0].Data.length;i++){filters.push(t.Data[0].Data[i].Key);f=t.Data[0].Data[i].Key;f=f.replace(/_/g," ");e="";switch(t.Data[0].Data[i].Key){case"Email":break;default:e=" deletable"}n+='<th data-id="'+t.Data[0].Data[i].Key+'" class="no-wrap'+e+'">'+f+"<\/th>"}for(n+="<\/thead><tbody>",i=0;i<t.Data.length;i++){for(n+='<tr data-id="'+t.Data[i].Id+'" data-uid="'+t.Data[i].UId+'" data-index="'+i+'">',n+='<td class="el-action-td el-action-click pointer text-center editable el-cell" data-el-id="'+t.Data[i].UId+'"><\/td>',u=0;u<t.Data[i].Data.length;u++)n+='<td data-horizontal="'+u+'"  onclick="EditData(this, event)" class="editable no-wrap">'+t.Data[i].Data[u].FormattedValue+"<\/td>";n+="<\/tr>"}n+="<\/tbody><\/table>";$("#mainHolder > section").html(n);SetUpFilters();SetUpEmailListActions();ClickHeaders()}else $("#loadingError #loadingMessage").html(t.Message),$("#loadingError").modal("show")},error:function(){$("#loadingError").modal("show")}})}function SetUpEmailListActions(){if(currentEmailList!=null&&currentEmailList!="00000000-0000-0000-0000-000000000000"){for(var n=0;n<customers.length;n++)$.ajax({url:"../Cloud/GetInEmailList",type:"post",data:JSON.stringify({cid:CurrentCompany,cuid:customers[n].UId,elid:currentEmailList}),contentType:"application/json",dataType:"json",traditional:"true",success:function(n){n.In?$('.el-action-td[data-el-id="'+n.Id+'"]').html('<span data-id="'+n.Id+'" class="el-action el-action-remove glyphicon glyphicon-minus-sign"><\/span>'):$('.el-action-td[data-el-id="'+n.Id+'"]').html('<span data-id="'+n.Id+'" class="el-action el-action-add glyphicon glyphicon-plus-sign"><\/span>')}});$(".el-action-click").on("click",function(){ELAction(this)});$(".el-action-td").show()}else $(".el-action-td").hide()}function ELAction(n){var t=$(n).children("span"),i=$(t).attr("data-id"),r=$(t).hasClass("el-action-add");r?$.ajax({url:"../Cloud/AddCustomerToEmailList",type:"post",data:JSON.stringify({cid:CurrentCompany,cuid:i,elid:currentEmailList}),contentType:"application/json",dataType:"json",traditional:"true",success:function(n){n.Success&&($(t).removeClass("el-action-add"),$(t).addClass("el-action-remove"),$(t).removeClass("glyphicon-plus-sign"),$(t).addClass("glyphicon-minus-sign"))}}):$.ajax({url:"../Cloud/RemoveCustomerFromEmailList",type:"post",data:JSON.stringify({cid:CurrentCompany,cuid:i,elid:currentEmailList}),contentType:"application/json",dataType:"json",traditional:"true",success:function(n){n.Success&&($(t).addClass("el-action-add"),$(t).removeClass("el-action-remove"),$(t).removeClass("glyphicon-minus-sign"),$(t).addClass("glyphicon-plus-sign"))}})}function EditData(n){var t=parseInt($(n).attr("data-horizontal"));currentIndex=$(n).parent().attr("data-index");currentHorizontal=t;var i=customers[currentIndex].Data[t].Descriminator,r=/([^!]*)/g.exec(i),u=r[1];switch(u){case"datetimeoffset":$("#dateTimePicker").show();$("#editString").hide();$("#dateTimePicker").data("datetimepicker").setDate(Date.parse(customers[currentIndex].Data[t].Value));break;default:$("#dateTimePicker").hide();$("#editString").show()}$("#editHeader").val(customers[currentIndex].Data[t].Key);$("#editVal").val(customers[currentIndex].Data[t].Value);$("#editData").modal("show")}function ClickHeaders(){$(".dataHeader th").on("click",function(){var n=$(this).attr("data-id"),t=!0;searchInformation.Sortings[0].ActingOn==n&&(t=!searchInformation.Sortings[0].Descending);searchInformation.Sortings[0].ActingOn=n;searchInformation.Sortings[0].Descending=t;searchInformation.Sortings=[{ActingOn:n,Descending:t,Priority:1}];$(this).parent(".dataHeader").children(".sort").remove();LoadCustomers()});$(".dataHeader th.deletable").on("contextmenu",function(n){currentHeader=$(this).attr("data-id");var t=n.pageY,i=n.pageX;return $("#contextMenuHeader").css({top:t,left:i}),$("#contextMenuHeader").show(),n.preventDefault(),!1});span=searchInformation.Sortings[0].Descending?' <span class="sort glyphicon glyphicon-arrow-down"><\/span>':' <span class="sort glyphicon glyphicon-arrow-up"><\/span>';$('.dataHeader th[data-id="'+searchInformation.Sortings[0].ActingOn+'"]').append(span)}var searchInformation={Page:1,RecordsPerPage:25,Company:CurrentCompany,Sortings:[{ActingOn:"Id",Descending:!0,Priority:1}],Filters:null,TotalRecords:-1,TotalPages:-1},customers,currentIndex,currentHorizontal,currentHeader,currentEmailList;$(document).ready(function(){$("#dateTimePicker").datetimepicker({language:"en"}).hide();$("#emailListError").hide();$("#timeZoneInfoDiv").hide();LoadEmailLists();$("#recordsPerPage").on("blur",function(){searchInformation.RecordsPerPage=$(this).val();searchInformation.Page=1;LoadCustomers()});$("#page").on("change",function(){searchInformation.Page=$(this).val();LoadCustomers()});$("#pageLeft").on("click",function(){searchInformation.Page>1&&(searchInformation.Page--,$("#page").val(searchInformation.Page),LoadCustomers())});$("#pageRight").on("click",function(){searchInformation.Page<searchInformation.TotalPages&&(searchInformation.Page++,$("#page").val(searchInformation.Page),LoadCustomers())});$("#newColumnDescriminatorTypeDiv").hide();$("#newColumnDescriminator").on("change",function(){$(this).val()=="decimal"||$(this).val()=="datetimeoffset"?$("#newColumnDescriminatorTypeDiv").slideDown():$("#newColumnDescriminatorTypeDiv").slideUp();$(this).val()=="datetimeoffset"?$("#timeZoneInfoDiv").slideDown():$("#timeZoneInfoDiv").slideUp()});$("#addColumn").on("click",function(){$("#newColumn").val("");$("#columnModal").modal("show")});$("#uploadContactList").on("click",function(){$("#uploadListProgress").hide();$("#uploadContactListModal").modal("show")});$("#newColumnSave").on("click",function(){var t=$("#newColumn").val(),n=$("#newColumnDescriminator").val(),i,r,u;n==""&&(n="string");i=$("#newColumnDescriminatorType").val();r=$("#timeZoneInfo").val();n=="decimal"&&(n="decimal!"+i);(n="datetimeoffset")&&(n="datetimeoffset!"+i+":"+r);t=t.replace(/ /g,"_");t=t.replace(/[^a-zA-Z0-9_]/g,"");u={Company:CurrentCompany,Column:t,Descriminator:n};$("#newColumnDescriminator").val("string");$("#newColumnDescriminatorTypeDiv").hide();$.ajax({url:"../Cloud/AddColumnToCustomerTable",type:"post",data:JSON.stringify(u),contentType:"application/json",dataType:"json",traditional:"true",success:function(n){n.Success?LoadCustomers():($("#saveError #saveMessage").html(n.Message),$("#saveError").modal())},error:function(){$("#saveError").modal("show");$("#saveMessage").html("")}})});$("#uploadList").on("submit",function(){if("undefined"==typeof FormData)return!0;var n=new FormData;return"undefined"==typeof n.append?!0:(n.append("files[]",$("#file").get(0).files[0]),n.append("Company",CurrentCompany),$.ajax({url:"../Cloud/UploadExcelSheetForContactList",type:"post",data:n,cache:!1,contentType:!1,processData:!1,success:function(n){$("#uploadContactListModal").modal("hide");n.Success?($("#informationModal .modal-title").html("Upload Successful"),$("#informationModal .modal-body").html('<div class="row"><div class="col-sm-10 col-sm-offset-1">File Successfully Uploaded.<\/div><\/div>'),LoadCustomers()):($("#informationModal .modal-title").html("Upload Error"),$("#informationModal .modal-body").html('<div class="row"><div class="col-sm-10 col-sm-offset-1">'+n.Message+'<\/div><div class="row"><div class="col-sm-10 col-sm-offset-1"><p class="text-center"><a href="RectifyContactListUploadError?cid='+CurrentCompany+"&ulid="+n.UId+'">Rectify Errors<\/a><\/p><\/div>'));$("#informationModal").modal("show")}}),!1)});$("#emailListSave").on("click",function(){var n=searchInformation;n.Name=$("#emailListName").val();$("#emailListError").html('<h4 class="text-center"><img src="../../Images/Programming/loading.gif" height="50px" /><\/h3>');$("#emailListError").show();$.ajax({url:"../Cloud/NewEmailListByFilter",type:"post",data:JSON.stringify(n),contentType:"application/json",dataType:"json",traditional:"true",success:function(n){n.Success?($("#emailListError").html('<h4 class="text-center">Email List Created<\/h3>'),$("#emailListError").show(),setTimeout(function(){ClearEmailListError()},1500)):($("#emailListError").html("<h4>"+result.Message+"<\/h4>"),$("#emailListError").show());$("#emailListName").val("")},error:function(){$("#emailListError").html("sets");$("#emailListError").show()}})});$("#createEmailList").on("click",function(){$("#emailListError").hide();$("#emailListModal").modal("show")});$("#activeEmailList").on("change",function(){currentEmailList=$(this).val();SetUpEmailListActions()});LoadCustomers();$("#editDataSave").on("click",function(){var u;SaveSprite("#spriteSave");var n=currentIndex,t=currentHorizontal,f=$("tr[data-index="+n+"]"),i=$(f).children("[data-horizontal="+t+"]"),r=$("#editVal").val();customers[n].Data[t].Value=r;$(i).html(r);u={Company:CurrentCompany,Data:customers[currentIndex]};$.ajax({url:"../Cloud/SaveCustomer",type:"post",data:JSON.stringify(u),contentType:"application/json",dataType:"json",traditional:"true",success:function(r){if(r.Success)for(var u=0;u<r.Data.Data.length;u++)r.Data.Data[u].Key==customers[n].Data[t].Key&&(customers[n].Data[t].FormattedValue=r.Data.Data[u].FormattedValue,$(i).html(customers[n].Data[t].FormattedValue));else SaveError("#spriteSave")},error:function(){SaveError("#spriteSave")}})});$(window).on("click",function(){$(".context-menu").hide()});$("#removeColumn").on("click",function(n){column=currentHeader;var t={Company:CurrentCompany,Column:column};$.ajax({url:"../Cloud/RemoveColumnFromCustomerTable",type:"post",data:JSON.stringify(t),contentType:"application/json",dataType:"json",traditional:"true",success:function(n){n.Success?LoadCustomers():($("#saveError #saveMessage").html(n.Message),$("#saveError").modal())},error:function(){$("#saveError").modal("show");$("#saveMessage").html("")}});n.stopPropagation();$("#contextMenuHeader").hide()});$("#editData").on("shown.bs.modal",function(){$("#editVal").focus()});$("#editVal").keyup(function(n){n.which==13&&$("#editDataSave").trigger("click");n.which==27&&$("#editData").modal("hide")});$("#changeFilters").on("click",function(){$("#filterModal").modal("show")});$("#filterNow").on("click",function(){searchInformation.Filters=currentFilters;searchInformation.Page=1;LoadCustomers()});$("#dateTimePicker").on("changeDate",function(){var n=$("#dateTimePicker").data("datetimepicker").getLocalDate();$("#editVal").val(n.toLocaleString())})});
//# sourceMappingURL=ContactList-old.min.js.map
