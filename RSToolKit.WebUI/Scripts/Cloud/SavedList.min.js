function LoadContacts(){processing.showPleaseWait();request.Filters=PopulateFilters();request.Contacts=[];request.UId=uid;$.ajax({url:"../../Cloud/SavedListContacts",type:"get",data:{rawJson:JSON.stringify(request)},contentType:"application/json",dataType:"json",success:function(n){var i,u,f,r,e,o,s,t;if(n.Success){for(i={},i.object=$("#contactData"),i.newHtml="",i.oldHtml=i.object.html(),$.extend(!0,request,n.Data),t=0;t<request.Contacts.length;t++){for(u=new Contact,$.extend(u,request.Contacts[t]),i.newHtml+='<tr data-index="'+t+'" id="'+u.UId+'">',i.newHtml+='<td><input type="checkbox" class="contact-selected" /><\/td>',i.newHtml+='<td><a href="../../Cloud/Contact/'+u.UId+'">'+u.Email+"<\/a><\/td>",f=0;f<headers.length;f++)r=new ContactData,e=findData(u.Data,headers[f].UId),e===null||typeof e=="undefined"?(r.HeaderKey=headers[f].UId,r.UId=u.UId,request.Contacts[t].Data.push(r),e={index:request.Contacts[t].Data.length-1}):$.extend(r,e.data),(r.Value===null||/^\s*$/.test(r.Value))&&(r.Value=""),i.newHtml+='<td class="item-editable" data-header-index="'+f+'" data-index="'+e.index+'">'+r.PrettyValue+"<\/td>";i.newHtml+="<\/tr>"}if(o=$("#pageNumber option"),o.length<request.TotalPages)for(t=o.length;t<request.TotalPages;t++)$("#pageNumber").append('<option value="'+(t+1)+'"'+(t+1==n.Page?' selected="true"':"")+">"+(t+1)+"<\/option>");else for(s=o.length-1,t=0;t<o.length-request.TotalPages;t++)o[s].remove(),s--;i.object.html(i.newHtml);BindEditables()}else alert(n.Message);processing.hidePleaseWait()},error:function(){alert("Server Error");processing.hidePleaseWait()}})}function BindEditables(){$(".item-editable").on("click",function(){(editing.td=$(this),editing.tr=$(this).parent("tr"),editing.contactIndex=editing.tr.attr("data-index"),editing.dataIndex=editing.td.attr("data-index"),editing.dataIndex=="-10"?editing.header.Descriminator=="email":editing.header=headers[editing.td.attr("data-header-index")],editing.contactIndex!=-1)&&(editing.contact=request.Contacts[editing.contactIndex],editing.dataIndex!=-1)&&(editing.data=request.Contacts[editing.contactIndex].Data[editing.dataIndex],ShowEditableItem())})}function RunBinding(){$('.editing-value[data-validate="datetime"]').datetimepicker();$('.editing-value[data-validate="date"]').datetimepicker({pickTime:!1});$('.editing-value[data-validate="time"]').datetimepicker({pickDate:!1})}function SaveData(){var n=$(".editing-value"),i=n.attr("data-validate"),t;switch(i){case"number":if(isNaN(editing.val())){alert("You must enter a valid number.");return}break;case"email":if(!/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(n.val())){alert("You must enter a valid email.");return}}processing.showPleaseWait();t={};t.UId=editing.data.UId;t.HeaderKey=editing.data.HeaderKey;t.Value=n.val();$.ajax({url:"../../Cloud/ContactData",type:"put",data:AddJsonAntiForgeryToken(t),dataType:"json",success:function(t){t.Success?(request.Contacts[editing.contactIndex].Data[editing.dataIndex].Value=n.val(),editing.td.html(n.val())):alert(t.Message);processing.hidePleaseWait()},error:function(){alert("Server Error");processing.hidePleaseWait()}})}function ShowEditableItem(){var t="",n;t+='<div class="row">';switch(editing.header.Descriminator){case"datetime":n=editing.data.Value;n==""&&(n=moment().format("MM/DD/YYYY h:mm A"));t+='<input type="text" class="editing-value form-control" data-validate="datetime" value="'+n+'">';break;case"date":n=editing.data.Value;n==""&&(n=moment().format("MM/DD/YYYY"));t+='<input type="text" class="editing-value form-control" data-validate="date" value="'+n+'">';break;case"time":n=editing.data.Value;n==""&&(n=moment().format("h:mm A"));t+='<input type="text" class="editing-value form-control" data-validate="time" value="'+n+'">';break;case"number":t+='<input type="number" class="editing-value form-control" data-validate="number" value="'+editing.data.Value+'">';break;case"email":t+='<input type="text" class="editing-value form-control" data-validate="email" value="'+editing.data.Value+'">';break;case"text":default:t+='<input type="text" class="editing-value form-control" data-validate="text" value="'+editing.data.Value+'">'}t+="<\/div>";$("#editModal").find(".modal-body").html(t);RunBinding();$("#editModal").modal("show")}function findData(n,t){for(var i=0;i<n.length;i++)if(n[i].HeaderKey==t)return{index:i,data:n[i]};return null}function findContact(n,t){for(var i=0;i<n.length;i++)if(n[i].UId==t)return n[i];return null}function findHeader(n){for(var t=0;t<headers.length;t++)if(headers[t].UId==n)return headers[t];return null}function SaveListRequest(){this.UId="00000000-0000-0000-0000-000000000000";this.Page=1;this.RecordsPerPage=25;this.TotalRecords=-1;this.TotalPages=-1;this.CompanyKey="";this.Sorting=new Sorting;this.Filters=[];this.Contacts=[]}function Sorting(){this.ActingOn="Email";this.Descending=!1}function Contact(){this.SortingId=-1;this.UId="00000000-0000-0000-0000-000000000000";this.CompanyKey="";this.Name="";this.Description="";this.Permission="";this.DateCreated="";this.DateModified="";this.Owner="";this.Group="";this.ModificationToken="";this.ModifiedBy="";this.Data=[];this.Email=""}function ContactData(){this.UId="00000000-0000-0000-0000-000000000000";this.SortingId=-1;this.Value="";this.PrettyValue="";this.HeaderKey=""}function ContactHeader(){this.UId="00000000-0000-0000-0000-000000000000";this.SortingId=-1;this.Name="";this.CompanyKey="";this.SavedListKey="";this.Descriminator="";this.DescriminatorOptions={}}var request=new SaveListRequest,editing={contact:new Contact,data:new ContactData,header:new ContactHeader,contactIndex:-1,dataIndex:-1,td:null,tr:null};$(document).on("ready",function(){$("#yesOverwriteReport").hide();$("#timezoneDiv").hide();$("#moneyDiv").hide();request.CompanyKey=CompanyKey;$("#addContact").on("click",function(){$("#newContact").modal("hide")});$(".table-sort").on("click",function(n){n.preventDefault();var t=$(this),i=t.attr("data-actingon");request.Sorting.ActingOn==i?(request.Sorting.Descending=!request.Sorting.Descending,t.children(".sort-icon").toggleClass("glyphicon-sort-by-attributes"),t.children(".sort-icon").toggleClass("glyphicon-sort-by-attributes-alt")):($(".sort-icon").removeClass("glyphicon-sort-by-attributes-alt").removeClass("glyphicon-sort-by-attributes"),request.Sorting.ActingOn=i,request.Sorting.Descending=!1,t.children(".sort-icon").addClass("glyphicon-sort-by-attributes"),t.children(".sort-icon").removeClass("glyphicon-sort-by-attributes-alt"));LoadContacts()});$("#headerDescriminator").on("change",function(){var n=$(this).val();switch(n){case"text":case"int":case"double":case"float":case"datetime":case"time":case"date":$("#timezoneDiv").hide();$("#moneyDiv").hide();break;case"datetimeoffset":$("#moneyDiv").hide();$("#timezoneDiv").show();break;case"decimal":$("#timezoneDiv").hide();$("#moneyDiv").show()}});$("#addHeader").on("click",function(){processing.showPleaseWait();$("#newHeader").modal("hide");var n={};n.Name=$("#headerName").val();n.Descriminator=$("#headerDescriminator").val();n.CompanyKey=CompanyKey;n.DescriminatorOptions=[];n.SavedListKey=uid;switch(n.Descriminator){case"datetimeoffset":n.DescriminatorOptions.push({Key:"timezone",Value:$("#headerTimezone").val()});break;case"decimal":n.DescriminatorOptions.push({Key:"culture",Value:$("#headerMoney").val()})}$.ajax({url:"../../Cloud/ContactHeader",type:"post",data:AddJsonAntiForgeryToken(n),dataType:"json",success:function(n){n.Success?window.location.reload():alert(n.Message);processing.hidePleaseWait()},error:function(){alert("Server Error");processing.hidePleaseWait()}})});$("#pageSize").on("blur",function(){var n=$(this).val();if(isNaN(n)){$(this).val("25");return}request.RecordsPerPage=n;LoadContacts()});$("#pageNumber").on("change",function(){request.Page=$(this).val();LoadContacts()});$("#pageLeft").on("click",function(){request.Page!=1&&(request.Page--,$("#pageNumber").val(request.Page),LoadContacts())});$("#pageRight").on("click",function(){request.Page!=request.TotalPages&&(request.Page++,$("#pageNumber").val(request.Page),LoadContacts())});$("#removeContact").on("click",function(){processing.showPleaseWait();$("#savedList").modal("hide");var n={};n.contacts=[];$(".contact-selected:checked").each(function(){var t=$(this).parent().parent();n.contacts.push(t.attr("id"))});n.id=uid;$.ajax({url:"../../Cloud/SavedListContacts",type:"delete",data:AddJsonAntiForgeryToken(n),dataType:"json",success:function(n){if(n.Success)for(var t=0;t<n.Removed.length;t++)$("#"+n.Removed[t]).remove();else alert(n.Message);processing.hidePleaseWait()},error:function(){alert("Server Error");processing.hidePleaseWait()}})});LoadContacts();$("#saveEdit").on("click",function(){SaveData()});$("#refreshList").on("click",function(n){n.preventDefault();LoadContacts()})});
//# sourceMappingURL=SavedList.min.js.map
