function TestSend(){var n=new XMLHttpRequest,t={id:email.UId,to:$("#testSend_To").val()};AddJsonAntiForgeryToken(t);n.open("post","../../Email/TestSend",!0);n.setRequestHeader("Content-Type","application/json");n.onerror=function(){processing.hidePleaseWait();alert("Unhandled server error.")};n.onload=function(n){if(n.currentTarget.status==200){var t=n.currentTarget,n=JSON.parse(t.responseText);n.Success?processing.hidePleaseWait():(processing.hidePleaseWait(),alert(n.Message))}else processing.hidePleaseWait(),alert("Page not found.")};n.send(JSON.stringify(t))}function SaveEmail(){var n=new XMLHttpRequest;n.open("put","../../Email/Email",!0);n.setRequestHeader("Content-Type","application/json");n.onerror=function(){processing.hidePleaseWait();alert("Unhandled server error.")};n.onload=function(n){if(n.currentTarget.status==200){var t=n.currentTarget,n=JSON.parse(t.responseText);n.Success?processing.hidePleaseWait():(processing.hidePleaseWait(),alert(n.Message))}else processing.hidePleaseWait(),alert("Page not found.")};processing.showPleaseWait();n.send(JSON.stringify(email))}function BindCKEditor(){$(".email-area-editable").each(function(){$(this).ckeditor({customConfig:"email_config.js"});$(this).ckeditorGet().on("change",function(n){var t=$(n.editor.element.$),i=t.attr("data-email-areaid"),r=FindEmailArea(i,email.EmailAreas);r.Html=n.editor.getData()});$(this).ckeditorGet().on("removearea.ckeditor",function(n){for(var r,u,f,i=$(n.editor.element.$),e=i.attr("data-email-areatype"),o=i.attr("data-email-areaid"),t=0;t<email.EmailAreas.length;t++)if(email.EmailAreas[t].SortingId==o){email.EmailAreas.splice(t,1);break}for(r=FindEmailAreas(e,email.EmailAreas),u=0,t=0;t<r.length;t++)r[t].Order=++u;f=i.closest(".email-area-holder");f.remove();n.editor.destroy()});$(this).ckeditorGet().on("areaUp.ckeditor",function(n){var t=$(n.editor.element.$),e=t.attr("data-email-areaid"),u=t.attr("data-email-areatype"),r=t.closest(".email-area-holder"),f=$("#"+u),i=r.prev();typeof i!="undefined"&&i!==null&&($(r).insertBefore(i),f.children(".email-area-holder").each(function(n){FindEmailArea($(this).find(".email-area-editable").attr("data-email-areaid"),email.EmailAreas).Order=n+1}))});$(this).ckeditorGet().on("areaDown.ckeditor",function(n){var t=$(n.editor.element.$),e=t.attr("data-email-areaid"),r=t.attr("data-email-areatype"),i=t.closest(".email-area-holder"),u=$("#"+r),f=i.next();$(i).insertAfter(f);u.children(".email-area-holder").each(function(n){FindEmailArea($(this).find(".email-area-editable").attr("data-email-areaid"),email.EmailAreas).Order=n+1})});$(this).ckeditorGet().on("emailareavariables.ckeditor",function(n){var f=$(n.editor.element.$),o=f.attr("data-email-areaid"),h=f.attr("data-email-areatype"),c=f.closest(".email-area-holder"),s=$("#variableModal"),e=s.find(".modal-body"),i,r,u,t;if(e.closest(".modal").data("email-areaid",o),i='<div class="form-horizontal"><div class="row">',r=FindEmailArea(o,email.EmailAreas),r!==null){for(u=0;u<r.Variables.length;u++)t=r.Variables[u],i+='<div class="col-sm-12"><label class="col-md-5 col-sm-12 control-label">'+t.Name+'<\/label><div class="col-md-7 col-sm-12"><input class="form-control emailarea-variable" type="text" data-input-type="'+t.Type+'" id="'+t.Variable+'" value="'+(t.Value===null?"":t.Value)+'"><\/div><\/div>';i+="<\/div><\/div>";e.html(i);e.runInputs();s.modal("show")}})})}function FindEmailArea(n,t){for(var i=0;i<t.length;i++)if(t[i].SortingId==n)return t[i];return null}function CompileEmail(){var i,o,n,r,f,e,t;if(processing.showPleaseWait(),i="",o=FindEmailTemplateArea("html",email.Template.EmailAreas),typeof o=="undefined"||o===null){debug&&alert("Email Parsing Error");return}for(i=o.Html,i=i.replace(rgx_removeNonEdititng,""),n=0;n<email.Variables.length;n++){t=email.Variables[n].Value;switch(email.Variables[n].Type){case"border":(t===null||t=="")&&(t="none");break;default:t===null&&(t="")}i=i.replace(new RegExp("@render_var_"+email.Variables[n].Variable,"gi"),t)}for(n=0;n<emailAreaTypes.length;n++)if(emailAreaTypes[n].toLowerCase()!="html"){var h=FindEmailTemplateArea(emailAreaTypes[n],email.Template.EmailAreas),u=FindEmailAreas(emailAreaTypes[n],email.EmailAreas),s="";for(r=0;r<u.length;r++){for(f=h.Html,e=0;e<u[r].Variables.length;e++){t=u[r].Variables[e].Value;switch(u[r].Variables[e].Type){case"border":(t===null||t=="")&&(t="none");break;default:t===null&&(t="")}f=f.replace(new RegExp("@render_var_"+u[r].Variables[e].Variable,"gi"),t)}f=f.replace(/@render_body/gi,'<div class="email-area-editable" contenteditable="true" data-email-areatype="'+emailAreaTypes[n]+'" data-email-areaid="'+u[r].SortingId+'">'+u[r].Html+"<\/div>");s+=f}i=i.replace(new RegExp("@render_"+emailAreaTypes[n],"gi"),s)}$("#email").html(i);$("div[data-email-automargin]").css("margin","auto");BindCKEditor();processing.hidePleaseWait()}function FindEmailTemplateArea(n,t){for(var i=0;i<t.length;i++)if(t[i].Type.toLowerCase()==n.toLowerCase())return t[i]}function FindEmailAreas(n,t){for(var r=[],i=0;i<t.length;i++)t[i].Type.toLowerCase()==n.toLowerCase()&&r.push(t[i]);return r.sort(emailComparer)}function emailComparer(n,t){return n.Order<t.Order?-1:n.Order>t.Order?1:0}function pullPlainText(){var o="",i="",s=FindEmailTemplateArea("html",email.Template.EmailAreas),t,r,f,e,n,l;if(typeof s=="undefined"||s===null){debug&&alert("Email Parsing Error");return}for(i=s.Html,i=i.replace(rgx_removeNonEdititng,""),t=0;t<email.Variables.length;t++){n=email.Variables[t].Value;switch(email.Variables[t].Type){case"border":(n===null||n=="")&&(n="none");break;default:n===null&&(n="")}n=n.trim();i=i.replace(new RegExp("@render_var_"+email.Variables[t].Variable,"gi"),n)}for(t=0;t<emailAreaTypes.length;t++)if(emailAreaTypes[t].toLowerCase()!="html"){var c=FindEmailTemplateArea(emailAreaTypes[t],email.Template.EmailAreas),u=FindEmailAreas(emailAreaTypes[t],email.EmailAreas),h="";for(r=0;r<u.length;r++){for(f=c.Html.trim(),e=0;e<u[r].Variables.length;e++){n=u[r].Variables[e].Value;switch(u[r].Variables[e].Type){case"border":(n===null||n=="")&&(n="none");break;default:n===null&&(n="")}n=n.trim();f=f.replace(new RegExp("@render_var_"+u[r].Variables[e].Variable,"gi"),n)}f=f.replace(/@render_body/gi,'<div class="email-area-editable" contenteditable="true" data-email-areatype="'+emailAreaTypes[t]+'" data-email-areaid="'+u[r].SortingId+'">'+u[r].Html.trim()+"<\/div>");h+=f}i=i.replace(new RegExp("@render_"+emailAreaTypes[t],"gi"),h.trim())}l=$(i);o=$(i).text().trim().replace(/\s{2,}/g,"\r\n");email.PlainText=o;$("#plainText").val(o)}CKEDITOR.disableAutoInline=!0;var debug=!0,sortingIdLoc=999999999,rgx_removeNonEdititng=/<!--editorignore-->[\s\S]*?<!--endeditorignore-->/gmi;$(document).on("ready",function(){AddJsonAntiForgeryToken(email);$("#saveEmail").on("click",function(n){n.preventDefault();SaveEmail()});$("#Name").on("input",function(){email.Name=$(this).val()});$("#EmailListKey").on("change",function(){email.EmailListKey=$(this).val()});$("#Subject").on("input",function(){email.Subject=$(this).val()});$("#Description").on("input",function(){email.Description=$(this).val()});$("#From").on("input",function(){email.From=$(this).val()});$("#CC").on("input",function(){email.CC=$(this).val()});$("#BCC").on("input",function(){email.BCC=$(this).val()});$("#EmailType").on("change",function(){email.EmailType=$(this).val()});$("#SendTime").on("input",function(){email.SendTime=$(this).val()});$("#RepeatSending").on("change",function(){email.RepeatSending=$(this).is(":checked")});$("#SendTime").datetimepicker({autoclose:!0,minuteStep:15,format:"M/D/YYYY hh:mm:00 A Z"}).on("dp.change",function(n){email.SendTime=n.date.format("M/D/YYYY hh:mm:00 A Z")});$("#To").on("input",function(){email.To=$(this).val()});$("#b_testSend").on("click",function(){$("#m_testSend").modal("hide");TestSend()});$("#b_s_sendSettings").on("click",function(){var i=$("#SendInterval");$("#m_sendSettings").modal("hide");var t=i.val(),n=0,r=i.attr("data-interval");switch(r){case"sec":n=t;break;case"min":n=t*60;break;case"hr":n=t*3600;break;case"day":n=t*86400;break;case"mo":n=t*30.5*86400;break;case"yr":n=t*31536e3}email.IntervalSeconds=n;email.MaxSends=$("#MaxSends").val()});$("#suffix_SendInterval").on("click",function(){var t=$("#SendInterval"),i=t.attr("data-interval"),n="";switch(i){case"sec":n="min";break;case"min":n="hr";break;case"hr":n="day";break;case"day":n="mo";break;case"mo":n="yr";break;case"yr":n="sec"}t.attr("data-interval",n);$(this).html(n)});$("#b_pullPlainText").on("click",function(){pullPlainText()});$("#b_plainText").on("click",function(){$(this).closest(".modal").modal("hide");email.PlainText=$("#plainText").val()});$("#b_c_plainText, #h_c_plainText").on("click",function(){$(this).closest(".modal").modal("hide");$("#plainText").val(email.PlainText)});$("#emailVariables").on("click",function(){var u=$("#variableModal"),r=u.find(".modal-body"),t,i,n;for(r.closest(".modal").data("email-areaid",-1),t='<div class="form-horizontal"><div class="row">',i=0;i<email.Variables.length;i++)n=email.Variables[i],t+='<div class="col-sm-12"><label class="col-md-5 col-sm-12 control-label">'+n.Name+'<\/label><div class="col-md-7 col-sm-12"><input class="form-control emailarea-variable" type="text" data-input-type="'+n.Type+'" id="'+n.Variable+'" value="'+(n.Value===null?"":n.Value)+'"><\/div><\/div>';t+="<\/div><\/div>";r.html(t);r.runInputs();u.modal("show")});$("#variableModal").on("hidden.bs.modal",function(){$(this).find(".modal-body").html("").data("id","")});$("#modalSaveChanges").on("click",function(){var t=$(this).closest(".modal"),i=t.data("email-areaid"),n,r;i==-1?r=t.find(".emailarea-variable").each(function(){for(var t=$(this),n=0;n<email.Variables.length;n++)email.Variables[n].Variable==t.attr("id")&&(email.Variables[n].Value=t.val())}):(n=FindEmailArea(i,email.EmailAreas),r=t.find(".emailarea-variable").each(function(){for(var i=$(this),t=0;t<n.Variables.length;t++)n.Variables[t].Variable==i.attr("id")&&(n.Variables[t].Value=i.val())}));$("#variableModal").modal("hide");CompileEmail()});$(".newAreaLink").on("click",function(n){var t;$("#newArea").modal("hide");processing.showPleaseWait();n.preventDefault();n.stopPropagation();var f=$(this),r=f.attr("data-email-type"),i=FindEmailTemplateArea(r,email.Template.EmailAreas);if(i===null){processing.hidePleaseWait();alert("Invalid area type.");return}var e=FindEmailAreas(r,email.EmailAreas),o=e.length+1,u={Name:"New Area",Type:r,Html:"New "+r+".",Order:o,Variables:[],SortingId:--sortingIdLoc};for(t=0;t<i.Variables.length;t++)u.Variables.push({Variable:i.Variables[t].Variable,Name:i.Variables[t].Name,Description:i.Variables[t].Description,Type:i.Variables[t].Type,Value:i.Variables[t].Value});email.EmailAreas.push(u);CompileEmail()});CompileEmail()});
//# sourceMappingURL=EditEmail.min.js.map
